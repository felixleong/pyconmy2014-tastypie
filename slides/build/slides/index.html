<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating Powerful RESTful APIs with Django-Tastypie &mdash; Creating Powerful RESTful APIs with Django-Tastypie 2014.03.14 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="_static/slides.css" type="text/css" />
    
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    

    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2014.03.14',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/common.js"></script>
    <script type="text/javascript" src="_static/slides.js"></script>
    <script type="text/javascript" src="_static/sync.js"></script>
    <script type="text/javascript" src="_static/controller.js"></script>
    <script type="text/javascript" src="_static/init.js"></script>
    
    <script type="text/javascript" src="_static/custom.js"></script>
    
    <link rel="top" title="Creating Powerful RESTful APIs with Django-Tastypie 2014.03.14 documentation" href="#" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  <article class="slide level-1" id="creating-powerful-restful-apis-with-django-tastypie">
<h1>Creating Powerful RESTful APIs with Django-Tastypie</h1>
<p><a class="reference external" href="http://twitter.com/felixleong/">Seh Hui Leong</a> <br />
March 2014, Mini PyCon Malaysia 2014</p>
<div class="figure">
<img alt="_images/4687542962_87bdc4f9f0_b.jpg" class="fill" src="_images/4687542962_87bdc4f9f0_b.jpg" />
<p class="caption">CC-BY-NC-SA <a class="reference external" href="https://flic.kr/p/89dTdf">https://flic.kr/p/89dTdf</a></p>
</div>

</article>
<article class="slide level-2" id="act-1-restful-is-awesome">
<h2>ACT 1: RESTful is AWESOME!</h2>
<div class="figure">
<img alt="_images/4960389917_1d0b48f117_b.jpg" class="fill" src="_images/4960389917_1d0b48f117_b.jpg" />
<p class="caption">CC <a class="reference external" href="http://www.flickr.com/photos/mccun934/4960389917/">http://www.flickr.com/photos/mccun934/4960389917/</a></p>
</div>

</article>
<article class="slide level-3" id="rest-what">
<h3>REST-what?</h3>
<ul>
<li><p class="first">REpresentational State Transfer</p>
</li>
<li><dl class="first docutils">
<dt><strong>Paradigm/Infrastructure pattern to designing easy-to-understand APIs</strong></dt>
<dd><ul class="first last simple">
<li>Both <strong>machine- and programmer-readable</strong> without convoluted protocols</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Usually called <strong>RESTful</strong> because no one seems to agree what a perfect REST
service is</p>
</li>
</ul>

</article>
<article class="slide level-3" id="making-the-perfect-bread-and-bacon">
<h3>Making the Perfect Bread and Bacon</h3>
<ul class="simple">
<li>Thinking in <strong>resources</strong></li>
<li><strong>Uniform Resource Identifier/Locator (URI/URL)</strong></li>
<li><strong>HTTP</strong>: The perfect <strong>uniform interface</strong></li>
</ul>

</article>
<article class="slide level-3" id="http-the-perfect-fit-i">
<h3>HTTP: The Perfect Fit (I)</h3>
<p>You can represent CRUD actions using <strong>HTTP verbs</strong></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><strong>Create</strong>:</th><td class="field-body">POST</td>
</tr>
<tr class="field-even field"><th class="field-name"><strong>Retrieve</strong>:</th><td class="field-body">GET</td>
</tr>
<tr class="field-odd field"><th class="field-name"><strong>Update</strong>:</th><td class="field-body">UPDATE</td>
</tr>
<tr class="field-even field"><th class="field-name"><strong>Delete</strong>:</th><td class="field-body">DELETE</td>
</tr>
</tbody>
</table>

</article>
<article class="slide level-3" id="http-the-perfect-fit-ii">
<h3>HTTP: The Perfect Fit (II)</h3>
<p>You can get status of your requests using <strong>HTTP status codes</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Code</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>200</td>
<td>OK</td>
</tr>
<tr class="row-odd"><td>201</td>
<td>Created</td>
</tr>
<tr class="row-even"><td>204</td>
<td>No-Content (i.e. return void)</td>
</tr>
<tr class="row-odd"><td>400</td>
<td>Bad Request</td>
</tr>
<tr class="row-even"><td>401</td>
<td>Unauthorized</td>
</tr>
<tr class="row-odd"><td>403</td>
<td>Forbidden</td>
</tr>
<tr class="row-even"><td>404</td>
<td>Not Found</td>
</tr>
<tr class="row-odd"><td>500</td>
<td>Internal Server Error (OMG BUG!)</td>
</tr>
</tbody>
</table>

</article>
<article class="slide level-3" id="http-the-perfect-fit-iii">
<h3>HTTP: The Perfect Fit (III)</h3>
<p>You can use <strong>HTTP headers</strong> to specify operating parameters of a transaction.</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Request header</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Accept</td>
<td>Content we want to request</td>
</tr>
<tr class="row-odd"><td>Authorization</td>
<td>Authentication credentials</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Response header</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Status</td>
<td>Status of the transaction</td>
</tr>
<tr class="row-odd"><td>Location</td>
<td>The destination URI (important for redirects)</td>
</tr>
</tbody>
</table>

</article>
<article class="slide level-2" id="act-2-hello-world-tastypie">
<h2>ACT 2: Hello World, Tastypie!</h2>
<div class="figure">
<img alt="_images/3294261072_c635d74ce8_o.jpg" class="fill" src="_images/3294261072_c635d74ce8_o.jpg" />
<p class="caption">CC-BY-NC <a class="reference external" href="https://flic.kr/p/626X3G">https://flic.kr/p/626X3G</a></p>
</div>

</article>
<article class="slide level-3" id="one-model-only-blog-app">
<h3>One Model Only Blog App</h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django_extensions.db.fields</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AutoSlugField</span><span class="p">,</span>
    <span class="n">CreationDateTimeField</span><span class="p">,</span>
    <span class="n">ModificationDateTimeField</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">taggit.managers</span> <span class="kn">import</span> <span class="n">TaggableManager</span>

<span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">is_private</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">time_created</span> <span class="o">=</span> <span class="n">CreationDateTimeField</span><span class="p">()</span>
    <span class="n">time_published</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="n">time_modified</span> <span class="o">=</span> <span class="n">ModificationDateTimeField</span><span class="p">()</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">TaggableManager</span><span class="p">()</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">AutoSlugField</span><span class="p">(</span><span class="n">prepopulate_from</span><span class="o">=</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="api-endpoints">
<h3>API Endpoints</h3>
<p>All with <strong>CRUD</strong> operations [POST/GET/PUT/DELETE]</p>
<ul class="simple">
<li>/api/v1/user/</li>
<li>/api/v1/user/:id/</li>
<li>/api/v1/tag/</li>
<li>/api/v1/tag/:id/</li>
<li>/api/v1/article/</li>
<li>/api/v1/article/:id/</li>
</ul>

</article>
<article class="slide level-3" id="magic-with-the-least-lines-1">
<h3>Magic with The Least Lines! #1</h3>
<p>blog/blog/api.py</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">tastypie.resources</span> <span class="kn">import</span> <span class="n">ModelResource</span>
<span class="kn">from</span> <span class="nn">taggit.models</span> <span class="kn">import</span> <span class="n">Tag</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Article</span>

<span class="c"># The user resource from Django Auth</span>
<span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;user&#39;</span>

<span class="c"># Tag resource for taggit model</span>
<span class="k">class</span> <span class="nc">TagResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;tag&#39;</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="magic-with-the-least-lines-2">
<h3>Magic with The Least Lines! #2</h3>
<p>blog/blog/api.py <em>(continued)</em></p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ArticleResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;article&#39;</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="magic-with-the-least-lines-3">
<h3>Magic with The Least Lines! #3</h3>
<p>blog/urls.py</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tastypie.api</span> <span class="kn">import</span> <span class="n">Api</span>
<span class="kn">from</span> <span class="nn">blog.api</span> <span class="kn">import</span> <span class="n">UserResource</span><span class="p">,</span> <span class="n">TagResource</span><span class="p">,</span> <span class="n">ArticleResource</span>

<span class="n">v1_api</span> <span class="o">=</span> <span class="n">Api</span><span class="p">(</span><span class="n">api_name</span><span class="o">=</span><span class="s">&#39;v1&#39;</span><span class="p">)</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">UserResource</span><span class="p">())</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TagResource</span><span class="p">())</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ArticleResource</span><span class="p">())</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span>
    <span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^api/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">v1_api</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="act-3-building-tastypie-apis-for-the-real-world">
<h2>ACT 3: Building Tastypie APIs for The Real World</h2>
<div class="figure">
<img alt="_images/5650815548_59e3c82b6a_b.jpg" class="fill" src="_images/5650815548_59e3c82b6a_b.jpg" />
<p class="caption">CC-BY-NC <a class="reference external" href="https://flic.kr/p/9BkUAh">https://flic.kr/p/9BkUAh</a></p>
</div>

</article>
<article class="slide level-3" id="limit-what-data-to-show">
<h3>Limit What Data To Show</h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;is_staff&#39;</span><span class="p">,</span> <span class="s">&#39;is_superuser&#39;</span><span class="p">,</span> <span class="s">&#39;last_login&#39;</span><span class="p">]</span>
        <span class="c"># ... or do this, if you prefer explicit white-listing instead</span>
        <span class="c">#fields = [&#39;id&#39;, &#39;first_name&#39;, &#39;last_name&#39;]</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="you-shall-not-pass-authentication">
<h3>You Shall Not Pass! <em>(Authentication)</em></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tastypie.authentication</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ApiKeyAuthentication</span><span class="p">,</span>
    <span class="n">Authentication</span><span class="p">,</span>
    <span class="n">MultiAuthentication</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ExtendedModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">ApiKeyAuthentication</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ArticleResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">MultiAuthentication</span><span class="p">(</span>
            <span class="n">ApiKeyAuthentication</span><span class="p">(),</span> <span class="n">Authentication</span><span class="p">())</span>
</pre></div>
</div>
<p>Supports HTTP-Basic, HTTP-Digest, API key, Session, OAuth 1, or
<a class="reference external" href="https://django-tastypie.readthedocs.org/en/latest/authentication.html#implementing-your-own-authentication-authorization">roll out your own</a>.</p>

</article>
<article class="slide level-3" id="full-crud-can-be-dangerous">
<h3>Full CRUD Can Be Dangerous</h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c"># ... Would only allow the retrieval of user listing, and support</span>
        <span class="c"># the update of user details</span>
        <span class="n">list_allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]</span>
        <span class="n">detail_allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;put&#39;</span><span class="p">]</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="limit-the-dataset-to-operate-on">
<h3>Limit The Dataset To Operate On</h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>

<span class="k">class</span> <span class="nc">ArticleResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_object_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">object_list</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ArticleResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">object_list</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">is_private</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">object_list</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="laying-out-authorization-boundaries">
<h3>Laying Out Authorization Boundaries</h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tastypie.authorization</span> <span class="kn">import</span> <span class="n">DjangoAuthorization</span>
<span class="kn">from</span> <span class="nn">.authorization</span> <span class="kn">import</span> <span class="n">ArticleAuthorization</span>

<span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c"># Relies on Django permissions as authorization</span>
        <span class="n">authorization</span> <span class="o">=</span> <span class="n">DjangoAuthorization</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ArticleResource</span><span class="p">(</span><span class="n">ExtendedModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c"># We need more fine grain control as we only allow original authors</span>
        <span class="c"># to edit their own entries</span>
        <span class="n">authorization</span> <span class="o">=</span> <span class="n">ArticleAuthorization</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Refer to blog/blog/api/authorization.py</strong> on a sample of how to implement a
custom authorization handler.</p>

</article>
<article class="slide level-3" id="adding-custom-api-endpoints">
<h3>Adding Custom API Endpoints</h3>
<p>Adding a convenience endpoint /api/v1/users/me/</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;{0})/(?P&lt;{1}&gt;me){2}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">,</span>
                <span class="n">trailing_slash</span><span class="p">()),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_detail&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&#39;api_dispatch_detail&#39;</span><span class="p">),</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;me&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">UserResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">put_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;me&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">detail_uri_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">UserResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">put_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="change-the-details-identifier-field">
<h3>Change The Details Identifier Field</h3>
<p>Like slugs instead of IDs? No problem!</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TagResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c"># THERE! So simple!</span>
        <span class="n">detail_uri_name</span> <span class="o">=</span> <span class="s">&#39;slug&#39;</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="nested-foreign-keys-and-related-querysets">
<h3>Nested Foreign Keys and Related Querysets</h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ArticleResource</span><span class="p">(</span><span class="n">ExtendedModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">AuthorResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;first_name&#39;</span><span class="p">,</span> <span class="s">&#39;last_name&#39;</span><span class="p">]</span>
            <span class="n">include_resource_uri</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">author</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">AuthorResource</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># We can also reuse our User Resource instead for more data</span>
    <span class="c"># author = fields.ForeignKey(UserResource, &#39;author&#39;, full=True)</span>

    <span class="c"># Under normal circumstances, only the API resource URI is used</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToManyField</span><span class="p">(</span><span class="n">TagResource</span><span class="p">,</span> <span class="s">&#39;tags&#39;</span><span class="p">)</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="adding-custom-fields">
<h3>Adding Custom Fields</h3>
<p>We can also add custom fields that is not defined in our models. For example,
useful aggregate fields.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TagResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dehydrate_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">taggit_taggeditem_items</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="add-filter-based-querying">
<h3>Add Filter Based Querying</h3>
<p>To support GET list filtering based on criteria on fields.</p>
<p>e.g. /api/v1/article/?title__icontains=malaysia</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tastypie.resources</span> <span class="kn">import</span> <span class="n">ModelResource</span><span class="p">,</span> <span class="n">ALL</span>

<span class="k">class</span> <span class="nc">ArticleResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">filtering</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
            <span class="s">&#39;tags&#39;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
            <span class="s">&#39;date_published&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;gt&#39;</span><span class="p">,</span> <span class="s">&#39;gte&#39;</span><span class="p">,</span> <span class="s">&#39;lt&#39;</span><span class="p">,</span> <span class="s">&#39;lte&#39;</span><span class="p">]</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Note that ALL (and ALL_WITH_RELATIONS) supports Django ORM query parameters.</p>

</article>
<article class="slide level-3" id="how-to-make-sure-incoming-data-is-validated">
<h3>How to Make Sure Incoming Data is Validated?</h3>
<p><em>(Not in sample code -- didn't hook things up proper in time)</em></p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tastypie.validation</span> <span class="kn">import</span> <span class="n">CleanedDataFormValidation</span>
<span class="kn">from</span> <span class="nn">..forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>

<span class="k">class</span> <span class="nc">ArticleResource</span><span class="p">(</span><span class="n">ExtendedModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">validation</span> <span class="o">=</span> <span class="n">CleanedDataFormValidation</span><span class="p">(</span><span class="n">form_class</span><span class="o">=</span><span class="n">ArticleForm</span><span class="p">)</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="complex-url-representations">
<h3>Complex URL Representations</h3>
<ul class="simple">
<li>Example: How to query articles written by a user?</li>
<li><strong>/api/v1/article/?author=1</strong> vs. <strong>/api/v1/user/1/article/</strong></li>
<li>Use <a class="reference external" href="https://github.com/felixleong/django-tastypie-extendedmodelresource/">django-tastypie-extendedmodelresource</a></li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">extendedmodelresource</span> <span class="kn">import</span> <span class="n">ExtendedModelResource</span>

<span class="c"># Inherit from EMR instead...</span>
<span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ExtendedModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Nested</span><span class="p">:</span>
        <span class="n">article</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToManyField</span><span class="p">(</span>
            <span class="s">&#39;blog.blog.api.ArticleResource&#39;</span><span class="p">,</span> <span class="s">&#39;article_set&#39;</span><span class="p">)</span>

<span class="c"># Must also be EMR</span>
<span class="k">class</span> <span class="nc">ArticleResource</span><span class="p">(</span><span class="n">ExtendedModelResource</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="performance-starts-with-queryset-optimization">
<h3>Performance Starts With Queryset Optimization</h3>
<ul class="simple">
<li>Normal ORM optimization tips apply -- <strong>select_related() and prefetch_related()
are your friends</strong> :).</li>
<li>Apply your Django DB/ORM optimization tricks to <tt class="docutils literal"><span class="pre">Resource.Meta.queryset</span></tt> or
<tt class="docutils literal"><span class="pre">Resource.get_object_list</span></tt>.</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ArticleResource</span><span class="p">(</span><span class="n">ExtendedModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">&#39;tags&#39;</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>

</article>
<article class="slide level-3" id="note-on-caching-on-tastypie">
<h3>Note on Caching on Tastypie</h3>
<ul>
<li><dl class="first docutils">
<dt>Supports:</dt>
<dd><ul class="first last simple">
<li><strong>Queryset caching</strong></li>
<li><strong>Client side caching</strong></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Don't support:</dt>
<dd><ul class="first last simple">
<li>Caching of serialized output</li>
</ul>
</dd>
</dl>
</li>
</ul>

</article>
<article class="slide level-3" id="caching-serialized-output-on-tastypie">
<h3>Caching Serialized Output on Tastypie</h3>
<ul>
<li><p class="first">Use a caching proxy like <a class="reference external" href="https://www.varnish-cache.org/">Varnish</a></p>
</li>
<li><p class="first">Personally have implemented a <a class="reference external" href="http://cdn.oreillystatic.com/en/assets/1/event/27/Accelerate%20your%20Rails%20Site%20with%20Automatic%20Generation-based%20Action%20Caching%20Presentation%201.pdf">Automatic Generation-Based Action Caching</a>
approach using a class mixin that can be used by a <tt class="docutils literal"><span class="pre">ModelResource</span></tt> and
hooked up <tt class="docutils literal"><span class="pre">post_save</span></tt> signals to update the generation count.</p>
<p><em>(Not included in the sample source :()</em></p>
</li>
</ul>

</article>
<article class="slide level-3" id="tastypie-urlpattern-auto-discovery">
<h3>Tastypie <tt class="docutils literal"><span class="pre">urlpattern</span></tt> Auto-discovery</h3>
<ul class="simple">
<li>Do it like <tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt> -- declare once and forget</li>
<li>Refer to <strong>blog/api.py</strong> and <strong>blog/utils/module_loading.py</strong></li>
<li>Django 1.7 will have <cite>django.utils.module_loading.autodiscover_modules</cite> <a class="footnote-reference" href="#id2" id="id1">[1]</a></li>
</ul>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Tastypie 0.11 is not compatible with Django 1.7</td></tr>
</tbody>
</table>

</article>
<article class="slide level-2" id="finale-you-are-now-smarter">
<h2>FINALE: You Are Now Smarter!</h2>
<div class="figure">
<img alt="_images/6966069023_5512204921_b.jpg" class="fill" src="_images/6966069023_5512204921_b.jpg" />
<p class="caption">CC-BY <a class="reference external" href="http://www.flickr.com/photos/sylvainkalache/6966069023/">http://www.flickr.com/photos/sylvainkalache/6966069023/</a></p>
</div>

</article>
<article class="slide level-3" id="you-have-learned">
<h3>You Have Learned…</h3>
<ul>
<li><p class="first">What is <strong>RESTful API</strong>?</p>
</li>
<li><p class="first">It's <strong>easy to get started</strong> with Tastypie</p>
</li>
<li><dl class="first docutils">
<dt>And how to <strong>flesh it out</strong> with real-world constraints:</dt>
<dd><ul class="first last simple">
<li>Basic CRUD restrictions</li>
<li>Adding custom API endpoints</li>
<li>Authentication and authorization</li>
<li>Customizing data fields of resources</li>
<li>Quick optimization wins</li>
</ul>
</dd>
</dl>
</li>
</ul>

</article>
<article class="slide level-3" id="gimme-everything">
<h3>GIMME EVERYTHING!</h3>
<p><strong>Code, Demo, Presentation</strong></p>
<p><a class="reference external" href="http://github.com/felixleong/pyconmy2014-tastypie/">http://github.com/felixleong/pyconmy2014-tastypie/</a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Email:</th><td class="field-body"><a class="reference external" href="mailto:felixleong&#37;&#52;&#48;gmail&#46;com">felixleong<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="field-even field"><th class="field-name">Facebook:</th><td class="field-body"><a class="reference external" href="http://facebook.com/leongsh/">http://facebook.com/leongsh/</a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Twitter:</th><td class="field-body"><a class="reference external" href="http://twitter.com/felixleong/">http://twitter.com/felixleong/</a></td>
</tr>
</tbody>
</table>

</article>
<article class="slide level-3" id="references">
<h3>References</h3>
<ul>
<li><dl class="first docutils">
<dt>Tastypie</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://django-tastypie.readthedocs.org/en/latest/">https://django-tastypie.readthedocs.org/en/latest/</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Tastypie-ExtendedModelResource</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://github.com/felixleong/django-tastypie-extendedmodelresource/">https://github.com/felixleong/django-tastypie-extendedmodelresource/</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>My previous talk, RESTful API 101</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://github.com/felixleong/wckl_restapi_talk/">https://github.com/felixleong/wckl_restapi_talk/</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>REST in Practice, <em>by Jim, Savas and Ian</em> (O'Reilly)</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="http://shop.oreilly.com/product/9780596805838.do">http://shop.oreilly.com/product/9780596805838.do</a></li>
</ul>
</dd>
</dl>
</li>
</ul>

</article>
<article class="slide level-3" id="license">
<h3>License</h3>
<p>This work is licensed under a <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.</p>

</article>


</section>

<section id="slide_notes">

</section>

  </body>
</html>